<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Menu Management</title>
  <link rel="icon" href="logo.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100..900;1,100..900&family=Smooch+Sans:wght@100..900&display=swap" rel="stylesheet">
  <style>
    :root{
      --color-primary: #42603b;
      --color-half:#a8c69e;
      --color-success: #41f1b6;
      --color-warning:#ffbb55;
      --color-white: #fff;
      --color-info-dark:#7d8da1;
      --color-info-light: #dce1eb;
      --color-dark:#363949;
      --color-light: rgba(132,139,200,0.18);
      --color-primary-variant:#111e88;
      --color-dark-variant: #677483;
      --color-background:#ffffff;
      --card-border-radius: 2rem;
      --border-radius-1: 0.4rem;
      --border-radius-2: 0.8rem;
      --border-radius-3: 1.2rem;
      --card-padding: 1.8rem;
      --padding-1: 1.2rem;
      --box-shadow: 0 1rem 2rem var(--color-light);
    }

    html{
      font-size: 14px;
    }

    body{
      width: 100vw;
      height: 100vh;
      font-size: 0.88rem;
      background: var(--color-background);
      user-select: none;
      overflow-x: hidden;
    }

    *{
      margin: 0;
      padding: 0;
      outline: 0;
      appearance: none;
      border: 0;
      text-decoration: none;
      list-style: none;
      box-sizing: border-box;
      font-family: 'montserrat';
    }

    .container{
      display: grid;
      width: 96%;
      margin: 0 auto;
      gap: 1.8rem;
      grid-template-columns: 14rem auto 23rem;
    }

    a{
      color: var(--color-dark);
    }

    img{
      display: block;
      width: 100%;
    }

    h1{
      font-weight: 800;
      font-size: 1.8rem;
    }

    h2{
      font-size: 1.4rem;
    }

    h3{
      font-size: 0.8rem;
    }

    h5{
      font-size: 0.7rem;
    }

    small{
      font-size: 0.75rem;
    }

    .profile-photo{
      width: 2.8rem;
      height: 2.8rem;
      border-radius: 50%;
      overflow: hidden;
    }

    .text-muted{
      color: var(--color-info-dark);
    }

    p{
      color: var(--color-dark-variant);
    }

    b{
      color: var(--color-dark);
    }

    .primary{
      color: var(--color-primary);
    }

    .half{
      color: var(--color-half);
    }

    .success{
      color: var(--color-success);
    }

    .warning{
      color: var(--color-warning);
    }

    aside{
      height: 100vh;
    }

    aside .top{
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 1.4rem;
      padding: 0 1rem;
    }

    aside h2{
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
    }

    aside .logo{
      display: flex;
      gap: 0.8rem;
      align-items: center;
    }

    aside .logo img{
      width: 2rem;
      height: 2rem;
    }

    aside .close-btn{
      display: none;
      font-size: 2rem;
    }

    aside .sidebar{
      display: flex;
      flex-direction: column;
      height: 86vh;
      position: relative;
      top: 3rem;
    }

    aside h3{
      font-weight: 500;
    }

    aside .sidebar a{
      display: flex;
      color: var(--color-info-dark);
      margin-left: 2rem;
      gap: 1rem;
      align-items: center;
      position: relative;
      height: 3.7rem;
      transition: all 300ms ease;
    }

    aside .sidebar a i{
      font-size: 1.6rem;
      transition: all 300ms ease; 
    }

    aside .sidebar a:last-child{
      position: absolute;
      bottom: 2rem;
      width: 100%;
    }

    aside .sidebar a.active{
      background: var(--color-light);
      color: var(--color-primary);
      margin-left: 0;
    }

    aside .sidebar a.active:before{
      content: '';
      width: 6px;
      height: 100%;
      background: var(--color-primary);
    }

    aside .sidebar a.active span{
      color: var(--color-primary);
      margin-left: calc(1rem - 3px);
    }

    aside .sidebar a:hover{
      color: var(--color-primary);
    }

    aside .sidebar a:hover i{
      margin-left: 1rem;
    }

    main {
      margin-top: 4rem;
    }

    .button {
      margin-top: 20px;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .upload-line {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .menu-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .manual-line {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .button button {
      padding: 0.8rem 1.5rem;
      border-radius: var(--border-radius-1);
      cursor: pointer;
      font-weight: 500;
      transition: all 300ms ease;
      background: var(--color-primary);
      color: var(--color-white);
    }

    .button button:hover {
      background: var(--color-half);
    }

    .button button.generate {
      background: #42603b;
    }

    .button button.generate:hover {
      background:#42603b;
    }

    .button label,
    .button button,
    .button select {
      background-color: var(--color-primary);
      color: rgb(255, 255, 255);
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      border: none;
    }

    .button label:hover,
    .button button:hover,
    .button select:hover {
      background-color: var(--color-half);
    }

    .button input[type="file"] {
      display: none;
    }

    .menu-type {
      margin-left: 10px;
    }

    .menu-preference {
      display: none;
      margin-left: 10px;
    }

    .menu-preference.show {
      display: block;
    }

    #manualMenuContainer {
      margin-top: 30px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
      table-layout: fixed;
    }

    table th {
      background-color: var(--color-primary);
      color: white;
      padding: 16px 10px;
      text-align: center;
      vertical-align: middle;
      word-wrap: break-word;
      white-space: normal;
    }

    table td {
      border: 1px solid #ccc;
      padding: 16px 10px;
      min-width: 130px;
      height: 80px;
      font-size: 14px;
      vertical-align: top;
      word-wrap: break-word;
      white-space: normal;
      text-align: left;
    }

    table th:first-child {
      min-width: 160px;
      font-size: 15px;
      font-weight: 600;
    }

    table td[contenteditable="true"] {
      background-color: var(--color-white);
    }

    .date-day-cell {
      background-color: var(--color-primary);
      color: white;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      min-width: 150px;
      word-wrap: break-word;
      white-space: normal;
    }

    .date-day-cell .date {
      font-weight: bold;
      font-size: 1.1em;
    }

    .date-day-cell .day {
      font-size: 0.9em;
      opacity: 0.9;
    }

    .meal-cell {
      background-color: white;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      vertical-align: top;
      text-align: left;
      min-width: 150px;
    }

    .meal-title {
      font-weight: bold;
      color: var(--color-primary);
      text-align: center;
      padding-bottom: 8px;
      margin-bottom: 8px;
      border-bottom: 2px solid var(--color-primary);
    }

    .meal-section b {
      color: var(--color-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 5px;
      word-wrap: break-word;
      white-space: normal;
      text-align: left;
    }

    .food-item {
      flex-grow: 1;
      word-wrap: break-word;
      white-space: normal;
      color: #495057;
      text-align: left;
      word-break: break-word;
    }

    .meal-section ul {
      margin: 0;
      padding-left: 18px;
      word-break: break-word;
      white-space: normal;
    }

    .meal-section li {
      margin-bottom: 3px;
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #e9ecef;
      flex-wrap: wrap;
      word-break: break-word;
      white-space: normal;
    }

    .meal-section li:last-child {
      border-bottom: none;
    }

    .dropdown {
      position: relative;
      width: 100%;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: var(--color-white);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      z-index: 1;
      min-width: 160px;
    }

    .dropdown-content a {
      padding: 10px 14px;
      display: block;
      text-decoration: none;
      color: black;
    }

    .dropdown-content a:hover {
      background-color: var(--color-light);
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .dropdown button {
      width: 100%;
      background-color: var(--color-primary);
      color: white;
      padding: 10px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .search-container {
      position: relative;
      width: 100%;
    }

    .search-input {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .dropdown-list {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--color-white);
      border: 1px solid #ccc;
      border-radius: 4px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .dropdown-list.show {
      display: block;
    }

    .dropdown-item {
      padding: 8px 12px;
      cursor: pointer;
    }

    .dropdown-item:hover {
      background-color: var(--color-light);
    }

    .menu-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 8px;
      margin-top: 20px;
    }

    .menu-table th {
      background-color: var(--color-primary);
      color: white;
      padding: 12px;
      text-align: center;
      border-radius: 8px;
    }

    .brunch-cell {
      background-color: var(--color-light);
    }

    .meal-section {
      margin-bottom: 10px;
      position: relative;
    }

    .meal-section:last-child {
      margin-bottom: 0;
    }

    .add-item-btn {
      background: none;
      border: none;
      color: var(--color-primary);
      cursor: pointer;
      padding: 2px 5px;
      font-size: 0.9rem;
      transition: all 0.2s ease;
      opacity: 0.7;
    }

    .add-item-btn:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .new-item-form {
      display: none;
      margin-top: 5px;
      background: white;
      padding: 5px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .new-item-form.active {
      display: block;
    }

    .new-item-input {
      width: 100%;
      padding: 5px;
      border: 1px solid var(--color-primary);
      border-radius: 4px;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }

    .item-actions {
      position: static;
      display: none;
      flex-shrink: 0;
      margin-left: 10px;
      gap: 5px;
    }

    .meal-section li:hover .item-actions {
      display: flex;
    }

    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 2px 5px;
      font-size: 0.9rem;
      transition: all 0.2s ease;
      opacity: 0.7;
    }

    .action-btn:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .edit-btn {
      color: var(--color-primary);
    }

    .delete-btn {
      color: #ff4444;
    }

    .edit-form {
      display: none;
      margin-top: 5px;
      background: white;
      padding: 5px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .edit-form.active {
      display: block;
    }

    .edit-input {
      width: 100%;
      padding: 5px;
      border: 1px solid var(--color-primary);
      border-radius: 4px;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }

    .save-cancel-btns {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }

    .save-btn, .cancel-btn {
      padding: 3px 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s ease;
    }

    .save-btn {
      background-color: var(--color-primary);
      color: white;
    }

    .save-btn:hover {
      background-color: var(--color-half);
    }

    .cancel-btn {
      background-color: #ff4444;
      color: white;
    }

    .cancel-btn:hover {
      background-color: #ff6666;
    }

    .protein-info {
      font-size: 0.8em;
      color: #666;
      margin-top: 2px;
      font-style: italic;
    }

    .date-selection {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin: 0 1rem;
    }

    .date-field {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .date-field label {
      color: var(--color-dark);
      font-weight: 500;
    }

    .date-field input[type="date"] {
      width: 100%;
      padding: 8px;
      border: 2px solid var(--color-info-light);
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.9rem;
      color: var(--color-dark);
      background-color: white;
      transition: all 0.3s ease;
      max-width: 180px;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
      background-color: #ffffff;
      padding: 5px;
      cursor: pointer;
      border-radius: 3px;
    }

    input[type="date"]::-webkit-datetime-edit {
      color: var(--color-dark);
    }

    .error-message {
      color: #ff0000;
      font-size: 0.9em;
      margin-top: 5px;
      display: none;
    }

    #startDateLabel {
      color: white;
    }

    .arrow-container {
      display: flex;
      align-items: center;
      margin: 0 2px;
    }

    .arrow-container i {
      color: var(--color-primary);
      font-size: 1.2rem;
    }

    /* Add new styles for menu display */
    .menu-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .menu-grid {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .menu-row {
      display: flex;
      background: white;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .date-box {
      min-width: 150px;
      padding: 10px;
      background: var(--color-primary);
      color: white;
      border-radius: 8px;
      text-align: center;
      margin-right: 20px;
    }

    .date {
      font-weight: bold;
      font-size: 1.1em;
    }

    .day {
      font-size: 0.9em;
      opacity: 0.9;
    }

    .menu-items {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .category-items {
      display: flex;
      gap: 10px;
      align-items: baseline;
    }

    .category {
      font-weight: bold;
      color: var(--color-primary);
      min-width: 100px;
    }

    .items {
      color: var(--color-dark);
    }

    .date-form {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin: 20px 0;
    }

    .date-selection-container {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    .date-field {
      flex: 0 0 auto;
      min-width: 150px;
    }

    .date-field label {
      display: block;
      color: var(--color-primary);
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }

    .date-field input[type="date"] {
      width: 100%;
      padding: 6px;
      border: 2px solid var(--color-info-light);
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.9rem;
      color: var(--color-dark);
      background-color: white;
      transition: all 0.3s ease;
      max-width: 150px;
    }

    .generate-btn {
      margin-left: 10px;
    }

    .generate-btn {
      background-color: var(--color-primary);
      color: white;
      padding: 12px 25px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      min-width: 180px;
      justify-content: center;
    }

    .generate-btn i {
      font-size: 1.1rem;
    }

    .generate-btn:hover {
      background: var(--color-primary-variant);
    }

    .generate-btn:active {
      transform: translateY(0);
    }

    /* Media Queries */
    @media screen and (max-width:1200px) {
      .container {
        width: 94%;
        grid-template-columns: 7rem auto 23rem;
      }
      aside .logo h2 {
        display: none;
      }
      aside .sidebar h3 {
        display: none;
      }
      aside .sidebar a:last-child {
        position: relative;
        margin-top: 1.8rem;
      }
      main .insights{
        grid-template-columns: 1fr;
        gap: 0;
      }
      main .recent-orders{
        width: 94%;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        margin: 2rem 0 0 8.8rem;
      }
      main .recent-orders table{
        width: 83vw;
      }
      main table thead tr th:last-child,
      main table thead tr th:first-child{
        display: none;
      }
      main table tbody tr td:last-child,
      main table tbody tr td:first-child{
        display: none;
      }
    }

    /* MEDIA QUERIES FOR MOBILE */
    @media screen and (max-width:768px) {
      .container {
        width: 100%;
        grid-template-columns: 1fr;
      }
      aside {
        position: fixed;
        left: -100%;
        background: var(--color-white);
        width: 18rem;
        z-index: 3;
        box-shadow: 1rem 3rem 4rem var(--color-light);
        height: 100vh;
        padding: var(--card-padding);
        display: none;
        animation: showMenu 400ms ease forwards;
      }
      @keyframes showMenu {
        to {
          left: 0;
        }
      }
      aside .logo {
        margin-left: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }
      aside .logo h2 {
        display: inline;
        margin: 0;
      }
      aside .sidebar h3 {
        display: inline;
      }
      aside .sidebar a {
        width: 100%;
        height: 3.4rem;
      }
      aside .sidebar a:last-child {
        position: absolute;
        bottom: 5rem;
      }
      aside .close-btn {
        display: inline-block;
        cursor: pointer;
        margin: 0;
        font-size: 1.5rem;
      }
      main {
        margin-top: 8rem;
        padding: 0 1rem;
      }
      main .recent-orders {
        position: relative;
        margin: 3rem 0 0 0;
        width: 100%;
      }
      main .recent-orders table {
        width: 100%;
        margin: 0;
      }
      .right {
        width: 94%;
        margin: 0 auto 4rem;
      }
      .right .top {
        position: fixed;
        top: 0;
        left: 0;
        align-items: center;
        padding: 0 0.8rem;
        height: 4.6rem;
        background: var(--color-white);
        width: 100%;
        margin: 0;
        z-index: 2;
        box-shadow: 0 1rem 1rem var(--color-light);
      }
      .right .profile .info {
        display: none;
      }
      .right .top button {
        display: inline-block;
        background: transparent;
        cursor: pointer;
        color: var(--color-dark);
        position: absolute;
        left: 1rem;
      }
      .right .top button span {
        font-size: 2rem;
      }
    }

    @media (max-width: 768px) {
      .date-selection-container {
        flex-direction: column;
        gap: 15px;
      }

      .date-field {
        width: 100%;
      }

      .generate-btn {
        width: 100%;
      }
    }

    .meal-sections {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      padding: 1rem;
    }

    .meal-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .meal-section h4 {
      color: #2c3e50;
      margin: 0 0 0.5rem 0;
      font-size: 1.1rem;
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 0.5rem;
    }

    .food-items {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .food-item {
      padding: 0.5rem;
      border-bottom: 1px solid #e9ecef;
      color: #495057;
    }

    .food-item:last-child {
      border-bottom: none;
    }

    .brunch-cell {
      background: #fff;
      border: 1px solid #dee2e6;
    }

    .meal-title {
      font-size: 1.2rem;
      font-weight: bold;
      color: #2c3e50;
      padding: 1rem;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-header h3 {
      color: var(--color-primary);
      margin: 0;
    }

    .modal-header button {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--color-dark);
      font-weight: 600;
    }

    .form-group input {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }

    .modal-footer button {
      padding: 0.8rem 1.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 300ms ease;
    }

    .modal-footer button[type="button"] {
      border: 1px solid #ddd;
      background: white;
    }

    .modal-footer button[type="submit"] {
      background: var(--color-primary);
      color: white;
      border: none;
    }

    .modal-footer button:hover {
      opacity: 0.9;
    }

    /* Right Sidebar Styles */
    .right {
      margin-top: 1.4rem;
    }

    .right .top {
      display: flex;
      justify-content: end;
      gap: 2rem;
    }

    .right .top button {
      display: none;
    }

    .right .top .profile {
      display: flex;
      text-align: right;
      gap: 0.5rem;
    }

    .right .top .profile .info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .right .top .profile .info p {
      margin: 0;
      font-weight: 400;
      color: var(--color-dark);
    }

    .right .top .profile .info small {
      color: var(--color-info-dark);
    }
  </style>
</head>
<body>
  <div class="container">
    <aside>
      <div class="top">
        <div class="logo">
          <a href="/dashboard" style="display: flex; gap: 0.8rem; align-items: center; text-decoration: none; color: inherit;">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="">
            <h2>REF<span class="half">EEDO</span></h2>
          </a>
        </div>
        <div class="close-btn"><i class="fa-solid fa-xmark"></i></div>
      </div>

      <div class="sidebar">
        <a href="/dashboard" class="{% if active_page == 'dashboard' %}active{% endif %}">
          <i class="fa-solid fa-table-columns"></i>
          <h3>DashBoard</h3>
        </a>
        <a href="/menu" class="{% if active_page == 'menu' %}active{% endif %}">
          <i class="fa-solid fa-plate-wheat"></i>
          <h3>Menu Management</h3>
        </a>
        <a href="/bom" class="{% if active_page == 'bom' %}active{% endif %}">
          <i class="fa-solid fa-paperclip"></i>
          <h3>BOM</h3>
        </a>
        <a href="/studentstaff" class="{% if active_page == 'studentstaff' %}active{% endif %}">
          <i class="fa-regular fa-folder-closed"></i>
          <h3>Student and Staff</h3>
        </a>
        <a href="/inventory" class="{% if active_page == 'inventory' %}active{% endif %}">
          <i class="fa-regular fa-cart-flatbed"></i>
          <h3>Inventory</h3>
        </a>
        <a href="/supplier" class="{% if active_page == 'supplier' %}active{% endif %}">
          <i class="fa-solid fa-boxes-packing"></i>
          <h3>Supplier</h3>
        </a>
        <a href="/analytics" class="{% if active_page == 'analytics' %}active{% endif %}">
          <i class="fa-solid fa-chart-line"></i>
          <h3>Analytics</h3>
        </a>
        <a href="/pax" class="{% if active_page == 'pax' %}active{% endif %}">
          <i class="fa-solid fa-arrow-right-from-bracket"></i>
          <h3>Meal Predictor</h3>
        </a>
        <a href="/settings" class="{% if active_page == 'settings' %}active{% endif %}">
          <i class="fa-solid fa-gear"></i>
          <h3>Settings</h3>
        </a>
        <a href="/logout">
          <i class="fa-solid fa-arrow-right-from-bracket"></i>
          <h3>Log Out</h3>
        </a>
      </div>
    </aside>

    <main>
      <div class="menu-container">
        <h1>Menu Generator</h1>
        
        <form class="date-form" method="POST" action="/generate">
          <div class="date-selection-container">
            <div class="date-field">
              <label for="start_date">
                <i class="fas fa-calendar-alt"></i>
                Start Date
              </label>
              <input type="date" id="start_date" name="start_date" required>
            </div>
            <div class="date-field">
              <label for="end_date">
                <i class="fas fa-calendar-alt"></i>
                End Date
              </label>
              <input type="date" id="end_date" name="end_date" required>
            </div>
            <button type="submit" class="generate-btn">
              <i class="fas fa-magic"></i>
              Generate Menu
            </button>
          </div>
        </form>

        {% if menu %}
        <!-- Generate BOM button - only shows after menu is generated -->
        <div style="margin: 1rem 0; text-align: center;">
          <button type="button" class="generate-btn" onclick="showBomPopup()">
            <i class="fa-solid fa-calculator"></i>
            Generate BOM
          </button>
        </div>

        {% if error %}
        <div class="error-message">
          {{ error }}
        </div>
        {% endif %}

        <table class="menu-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Breakfast</th>
              <th>Lunch</th>
              <th>Snacks</th>
              <th>Dinner</th>
            </tr>
          </thead>
          <tbody>
            {% for date, day_data in menu.items() %}
            <tr>
              <td class="date-day-cell">
                <div class="date">{{ day_data.Date }}</div>
                <div class="day">{{ day_data.Day }}</div>
              </td>
              {% if day_data.Day == 'Sunday' %}
                {# Handle Sunday Brunch #}
                <td class="meal-cell brunch-cell" colspan="2">
                  {% if 'Brunch' in day_data.Items %}
                  <div class="meal-title">Brunch</div>
                  {% for subcategory, items in day_data.Items['Brunch'].items() %}
                  <div class="meal-section" data-category="Brunch" data-subcat="{{ subcategory }}">
                    <b>
                      {{ subcategory }}
                      <button class="add-item-btn" onclick="showAddItemForm(this)">
                        <i class="fas fa-plus"></i>
                      </button>
                    </b>
                    <ul>
                      {% for item in items %}
                      <li>
                        <span class="food-item">{{ item }}</span>
                        <div class="item-actions">
                          <button class="action-btn edit-btn" onclick="editItem(this)" title="Edit">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button class="action-btn delete-btn" onclick="deleteItem(this)" title="Delete">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                        <div class="edit-form">
                          <input type="text" class="edit-input" value="{{ item }}">
                          <div class="save-cancel-btns">
                            <button class="save-btn" onclick="saveEdit(this)">Save</button>
                            <button class="cancel-btn" onclick="cancelEdit(this)">Cancel</button>
                          </div>
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                    <div class="new-item-form">
                      <input type="text" class="new-item-input" placeholder="Enter new dish">
                      <div class="save-cancel-btns">
                        <button class="save-btn" onclick="addNewItem(this)">Add</button>
                        <button class="cancel-btn" onclick="cancelAddItem(this)">Cancel</button>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                  {% endif %}
                </td>
                {# Continue with Snacks and Dinner for Sunday #}
                {% for meal_type in ['Snacks', 'Dinner'] %}
                <td class="meal-cell">
                  {% if meal_type in day_data.Items %}
                  <div class="meal-title">{{ meal_type }}</div>
                  {% for subcategory, items in day_data.Items[meal_type].items() %}
                  <div class="meal-section" data-category="{{ meal_type }}" data-subcat="{{ subcategory }}">
                    <b>
                      {{ subcategory }}
                      <button class="add-item-btn" onclick="showAddItemForm(this)">
                        <i class="fas fa-plus"></i>
                      </button>
                    </b>
                    <ul>
                      {% for item in items %}
                      <li>
                        <span class="food-item">{{ item }}</span>
                        <div class="item-actions">
                          <button class="action-btn edit-btn" onclick="editItem(this)" title="Edit">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button class="action-btn delete-btn" onclick="deleteItem(this)" title="Delete">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                        <div class="edit-form">
                          <input type="text" class="edit-input" value="{{ item }}">
                          <div class="save-cancel-btns">
                            <button class="save-btn" onclick="saveEdit(this)">Save</button>
                            <button class="cancel-btn" onclick="cancelEdit(this)">Cancel</button>
                          </div>
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                    <div class="new-item-form">
                      <input type="text" class="new-item-input" placeholder="Enter new dish">
                      <div class="save-cancel-btns">
                        <button class="save-btn" onclick="addNewItem(this)">Add</button>
                        <button class="cancel-btn" onclick="cancelAddItem(this)">Cancel</button>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                  {% endif %}
                </td>
                {% endfor %}
              {% else %}
                {# Handle regular days (Monday-Saturday) #}
                {% for meal_type in ['Breakfast', 'Lunch', 'Snacks', 'Dinner'] %}
                <td class="meal-cell">
                  {% if meal_type in day_data.Items %}
                  <div class="meal-title">{{ meal_type }}</div>
                  {% for subcategory, items in day_data.Items[meal_type].items() %}
                  <div class="meal-section" data-category="{{ meal_type }}" data-subcat="{{ subcategory }}">
                    <b>
                      {{ subcategory }}
                      <button class="add-item-btn" onclick="showAddItemForm(this)">
                        <i class="fas fa-plus"></i>
                      </button>
                    </b>
                    <ul>
                      {% for item in items %}
                      <li>
                        <span class="food-item">{{ item }}</span>
                        <div class="item-actions">
                          <button class="action-btn edit-btn" onclick="editItem(this)" title="Edit">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button class="action-btn delete-btn" onclick="deleteItem(this)" title="Delete">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                        <div class="edit-form">
                          <input type="text" class="edit-input" value="{{ item }}">
                          <div class="save-cancel-btns">
                            <button class="save-btn" onclick="saveEdit(this)">Save</button>
                            <button class="cancel-btn" onclick="cancelEdit(this)">Cancel</button>
                          </div>
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                    <div class="new-item-form">
                      <input type="text" class="new-item-input" placeholder="Enter new dish">
                      <div class="save-cancel-btns">
                        <button class="save-btn" onclick="addNewItem(this)">Add</button>
                        <button class="cancel-btn" onclick="cancelAddItem(this)">Cancel</button>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                  {% endif %}
                </td>
                {% endfor %}
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="button">
          <button type="button" class="main-button" id="saveMenuBtn"><i class="fa-solid fa-file-excel"></i> Save Menu as Excel</button>
        </div>
        {% else %}
        <div class="no-menu-message">
          <p>No menu generated yet. Please select dates and generate a menu.</p>
        </div>
        {% endif %}
      </div>
    </main>

    <div class="right">
      <div class="top">
        <button id="menu-btn"><i class="fa-solid fa-bars"></i></button>
        <div class="profile">
          <div class="info">
            <p>Hey,</p>
            <small class="text-muted">Admin</small>
          </div>
          <div class="profile-photo">
            <img src="{{ url_for('static', filename='images/profile2.jpg') }}" alt="profile">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BOM Popup Modal -->
  <div id="bomModal" class="modal" style="display: none;">
    <div class="modal-content" style="background: white; padding: 2rem; border-radius: 8px; max-width: 400px; margin: 10% auto;">
      <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h3 style="color: var(--color-primary); margin: 0;">Generate Bill of Materials</h3>
        <button onclick="closeBomModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
      </div>
      <form id="bomForm" method="POST" action="/generate_bom_from_menu">
        <div class="form-group" style="margin-bottom: 1.5rem;">
          <label for="num_students" style="display: block; margin-bottom: 0.5rem; color: var(--color-dark); font-weight: 600;">
            <i class="fas fa-users"></i>
            Number of Students
          </label>
          <input type="number" id="num_students" name="num_students" required min="1" 
                 style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;"
                 placeholder="Enter number of students">
        </div>
        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 1rem;">
          <button type="button" onclick="closeBomModal()" 
                  style="padding: 0.8rem 1.5rem; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">
            Cancel
          </button>
          <button type="submit" 
                  style="padding: 0.8rem 1.5rem; background: var(--color-primary); color: white; border: none; border-radius: 4px; cursor: pointer;">
            Generate BOM
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    function formatDate(date) {
      const d = new Date(date);
      return d.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    }

    // This function seems to be for a different display structure, keeping for now but commented out as it might not be used
    /*
    function displayMenu(menu) {
      const tableBody = document.getElementById('menuTableBody');
      const menuContainer = document.getElementById('autoMenuContainer');
      tableBody.innerHTML = '';

      // Create table header - This is already in the HTML template, so this might be redundant
      const headerRow = document.createElement('tr');
      ['Date', 'Day', 'Breakfast', 'Lunch', 'Snacks', 'Dinner'].forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
      });
      tableBody.appendChild(headerRow); // This will add a second header row if the template has one

      // Add data rows
      menu.forEach(day => {
        const row = document.createElement('tr');
        // Date cell
        const dateCell = document.createElement('td');
        dateCell.textContent = formatDate(day.Date);
        row.appendChild(dateCell);
        // Day cell
        const dayCell = document.createElement('td');
        dayCell.textContent = day.Day;
        row.appendChild(dayCell);
        // Meal cells
        ['Breakfast', 'Lunch', 'Snacks', 'Dinner', 'Brunch'].forEach(meal => { // Includes Brunch here
          const mealCell = document.createElement('td');
          if (day.Items && day.Items[meal]) {
            const packet = day.Items[meal];
            // Show each category in the packet
            Object.entries(packet).forEach(([cat, items]) => {
              if (items && items.length > 0) {
                const catTitle = document.createElement('div');
                catTitle.style.fontWeight = 'bold';
                catTitle.style.marginTop = '4px';
                catTitle.textContent = cat.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                mealCell.appendChild(catTitle);
                const ul = document.createElement('ul');
                ul.style.listStyle = 'none';
                ul.style.padding = '0 0 0 10px';
                items.forEach(item => {
                  const li = document.createElement('li');
                  li.textContent = item;
                  ul.appendChild(li);
                });
                mealCell.appendChild(ul);
              }
            });
          }
          row.appendChild(mealCell);
        });
        tableBody.appendChild(row);
      });
      // Show the menu container - This ID doesn't exist
      // menuContainer.style.display = 'block';
    }
    */

    // Add event listener for the auto-generate button - REMOVED: autoGenerateBtn does not exist
    // document.getElementById('autoGenerateBtn').addEventListener('click', function() { ... });

    // Add event listener for the manual button - REMOVED: .Manual does not exist
    // document.querySelector('.Manual').addEventListener('click', function() { ... });

    // Add event listener for save manual menu button - REMOVED: saveManualMenu does not exist
    // document.getElementById('saveManualMenu').addEventListener('click', function() { ... });

    // Set default dates and hide containers on DOMContentLoaded - Modified to only set dates
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const startDate = new Date(today);
      startDate.setDate(today.getDate() + 1);
      
      const endDate = new Date(startDate);
      endDate.setDate(startDate.getDate() + 14);
      
      // Format dates to YYYY-MM-DD for the input[type="date"] value
      const formatIsoDate = (date) => date.toISOString().split('T')[0];

      document.getElementById('start_date').value = formatIsoDate(startDate);
      document.getElementById('end_date').value = formatIsoDate(endDate);
      
      // These containers do not exist in this file, removed hiding logic
      // document.getElementById('autoMenuContainer').style.display = 'none';
      // document.getElementById('manualMenuContainer').style.display = 'none';
    });

    function editItem(btn) {
      const li = btn.closest('li');
      const foodItem = li.querySelector('.food-item');
      const editForm = li.querySelector('.edit-form');
      const editInput = editForm.querySelector('.edit-input');
      
      // Hide the food item and action buttons
      foodItem.style.display = 'none';
      // Check if item-actions element exists before trying to access its style
      const itemActions = li.querySelector('.item-actions');
      if (itemActions) {
        itemActions.style.display = 'none';
      }
      
      // Show and focus the edit form
      editForm.classList.add('active');
      editInput.value = foodItem.textContent;
      editInput.focus();
    }

    function saveEdit(btn) {
      const li = btn.closest('li');
      const foodItem = li.querySelector('.food-item');
      const editForm = li.querySelector('.edit-form');
      const editInput = editForm.querySelector('.edit-input');
      const itemActions = li.querySelector('.item-actions');
      const mealSection = li.closest('.meal-section');
      
      // Find the date cell correctly - traverse up to the row, then find the specific cell
      const row = li.closest('tr');
      let dateCellText = '';
      if (row) {
        const dateDayCell = row.querySelector('.date-day-cell');
        if (dateDayCell) {
          const dateElement = dateDayCell.querySelector('.date');
          if (dateElement) {
             dateCellText = dateElement.textContent;
          }
        }
      }
      const dateCell = dateCellText; // Use the extracted date string

      const newValue = editInput.value.trim();
      if (newValue) {
        const oldValue = foodItem.textContent;
        
        // Make API call to update the backend
        updateMenuItem(
          mealSection.dataset.category, // This gets the category from the data-category attribute
          mealSection.dataset.subcat,   // This gets the subcategory from the data-subcat attribute
          oldValue,
          newValue,
          dateCell // Pass the extracted date string
        );
        
        // Update UI optimistically
        foodItem.textContent = newValue;
      }
      
      // Reset the display
      foodItem.style.display = 'inline';
      // Check if item-actions element exists
      if (itemActions) {
        itemActions.style.display = 'none';
      }
      editForm.classList.remove('active');
    }

    function cancelEdit(btn) {
      const li = btn.closest('li');
      const foodItem = li.querySelector('.food-item');
      const editForm = li.querySelector('.edit-form');
      const itemActions = li.querySelector('.item-actions');
      
      // Reset the display
      foodItem.style.display = 'inline';
       // Check if item-actions element exists
      if (itemActions) {
        itemActions.style.display = 'none';
      }
      editForm.classList.remove('active');
    }

    function deleteItem(btn) {
      if (confirm('Are you sure you want to delete this item?')) {
        const li = btn.closest('li');
        const foodItem = li.querySelector('.food-item');
        const mealSection = li.closest('.meal-section');
        
         // Find the date cell correctly - traverse up to the row, then find the specific cell
        const row = li.closest('tr');
        let dateCellText = '';
        if (row) {
          const dateDayCell = row.querySelector('.date-day-cell');
           if (dateDayCell) {
            const dateElement = dateDayCell.querySelector('.date');
            if (dateElement) {
               dateCellText = dateElement.textContent;
            }
          }
        }
        const dateCell = dateCellText; // Use the extracted date string
        
        // Store the item details before deletion
        const itemDetails = {
          category: mealSection.dataset.category, // Get category
          subcat: mealSection.dataset.subcat,   // Get subcategory
          value: foodItem.textContent,
          date: dateCell // Use the extracted date string
        };
        
        // Make API call to delete from backend
        deleteMenuItem(itemDetails, li);
      }
    }

    function deleteMenuItem(itemDetails, li) {
      fetch('/delete_menu_item', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(itemDetails)
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          console.error('Delete error:', data.error);
          alert('Error deleting menu item: ' + data.error);
        } else {
          console.log('Successfully deleted menu item');
          // Remove the item from UI
          if (li && li.parentNode) {
            li.parentNode.removeChild(li);
          }
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error deleting menu item. Please try again.');
      });
    }

    function updateMenuItem(category, subcat, oldValue, newValue, date) {
      fetch('/update_menu_item', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          category: category,
          subcat: subcat,
          oldValue: oldValue,
          newValue: newValue,
          date: date
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          console.error('Update error:', data.error);
          alert('Error updating menu item: ' + data.error);
          // Revert the change in UI if there was an error - needs a more robust way to find the specific element
          // For now, just log the error. Finding the exact element by category and subcat globally might be complex.
        } else {
          console.log('Successfully updated menu item');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error updating menu item. Please try again.');
        // Revert the change in UI if there was an error
      });
    }

    function showAddItemForm(btn) {
      const mealSection = btn.closest('.meal-section');
      const newItemForm = mealSection.querySelector('.new-item-form');
      const input = newItemForm.querySelector('.new-item-input');
      
      // Hide all other open forms first
      document.querySelectorAll('.new-item-form.active').forEach(form => {
        if (form !== newItemForm) {
          form.classList.remove('active');
          form.querySelector('.new-item-input').value = '';
        }
      });
      
      // Show this form
      newItemForm.classList.add('active');
      input.value = '';
      input.focus();
    }

    function cancelAddItem(btn) {
      const form = btn.closest('.new-item-form');
      const input = form.querySelector('.new-item-input');
      input.value = '';
      form.classList.remove('active');
    }

    function addNewItem(btn) {
      const form = btn.closest('.new-item-form');
      const mealSection = form.closest('.meal-section');
      const input = form.querySelector('.new-item-input');
      const newValue = input.value.trim();
      
      // Find the date cell correctly
      const row = mealSection.closest('tr');
      let dateCellText = '';
      if (row) {
        const dateDayCell = row.querySelector('.date-day-cell');
         if (dateDayCell) {
          const dateElement = dateDayCell.querySelector('.date');
          if (dateElement) {
             dateCellText = dateElement.textContent;
          }
        }
      }
      const dateCell = dateCellText; // Use the extracted date string
      
      if (!newValue) {
        alert('Please enter a dish name');
        return;
      }

      // Disable the form while processing
      const saveBtn = form.querySelector('.save-btn');
      const cancelBtn = form.querySelector('.cancel-btn');
      saveBtn.disabled = true;
      cancelBtn.disabled = true;
      input.disabled = true;

      // Create new list item optimistically
      const ul = mealSection.querySelector('ul');
      const li = document.createElement('li');
      li.innerHTML = `
        <span class="food-item">${newValue}</span>
        <div class="item-actions">
          <button class="action-btn edit-btn" onclick="editItem(this)" title="Edit">
            <i class="fas fa-edit"></i>
          </button>
          <button class="action-btn delete-btn" onclick="deleteItem(this)" title="Delete">
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <div class="edit-form">
          <input type="text" class="edit-input" value="${newValue}">
          <div class="save-cancel-btns">
            <button class="save-btn" onclick="saveEdit(this)">Save</button>
            <button class="cancel-btn" onclick="cancelEdit(this)">Cancel</button>
          </div>
        </div>
      `;
      ul.appendChild(li);

      // Make API call to add the new item
      fetch('/add_menu_item', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          category: mealSection.dataset.category, // Get category
          subcat: mealSection.dataset.subcat,   // Get subcategory
          value: newValue,
          date: dateCell // Use the extracted date string
        })
      })
      .then(response => {
        if (!response.ok) {
          // If the response is not ok, try to read the error message from the body
          return response.json().then(data => { throw new Error(data.error || `HTTP error! status: ${response.status}`); });
        }
        return response.json();
      })
      .then(data => {
        if (data.error) {
           throw new Error(data.error); // Throw if there's an error key in the JSON
        }
        console.log('Successfully added new menu item');
        // Clear and hide the form
        input.value = '';
        form.classList.remove('active');
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error adding menu item: ' + error.message);
        // Remove the item from UI if there was an error
        li.remove();
      })
      .finally(() => {
        // Re-enable the form
        saveBtn.disabled = false;
        cancelBtn.disabled = false;
        input.disabled = false;
      });
    }

    function regenerateMenu() {
      // Get the current date range
      const startDateInput = document.getElementById('start_date');
      const endDateInput = document.getElementById('end_date');

      const startDate = startDateInput ? startDateInput.value : null;
      const endDate = endDateInput ? endDateInput.value : null;
      
      if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
      }

      // Submit the form to regenerate the menu
      // Find the existing form or create a new one if necessary
      let form = document.querySelector('form.date-form');
      if (!form) {
          form = document.createElement('form');
          form.method = 'POST';
          form.action = '/generate';
          // Append to body temporarily to submit
          document.body.appendChild(form);
      }

      // Ensure start_date and end_date inputs exist in the form
      let startInput = form.querySelector('input[name="start_date"]');
      if (!startInput) {
          startInput = document.createElement('input');
          startInput.type = 'hidden';
          startInput.name = 'start_date';
          form.appendChild(startInput);
      }
      startInput.value = startDate;

      let endInput = form.querySelector('input[name="end_date"]');
      if (!endInput) {
          endInput = document.createElement('input');
          endInput.type = 'hidden';
          endInput.name = 'end_date';
          form.appendChild(endInput);
      }
      endInput.value = endDate;

      // Submit the form
      form.submit();
       // If we created a temporary form, remove it after submission (though not strictly necessary as page navigates)
       if (!document.querySelector('form.date-form')) {
           // Small delay before removal if needed, but generally not for navigation
           // setTimeout(() => form.remove(), 100);
       }
    }

    // Add event listener for the Save button
    const saveMenuBtn = document.getElementById('saveMenuBtn');
    if (saveMenuBtn) {
      saveMenuBtn.addEventListener('click', () => {
          // Trigger the download by redirecting or fetching the download route
          // Removed the redirect logic to use the local downloadMenuAsExcel function
          downloadMenuAsExcel();
      });
    }

    function downloadMenuAsExcel() {
      console.log("Attempting to download menu as Excel...");

      // Get the menu table
      const menuTable = document.querySelector('.menu-table');
      if (!menuTable) {
        console.error('Error: Menu table not found.');
        alert('Error: Menu table not found.');
        return;
      }

      // Create a new worksheet with the desired header
      const ws = XLSX.utils.aoa_to_sheet([['Day', 'Meal Type', 'Dish 1', 'Dish 2', 'Dish 3', 'Dish 4']]);

      // Data array for the sheet, starting after the header
      const sheetData = [];

      // Get all data rows from the menu table body
      const rows = menuTable.querySelectorAll('tbody tr');

      console.log(`Found ${rows.length} menu rows.`);

      // Process each row (each day in the menu)
      rows.forEach((row) => {
        // Extract Day and Date
        const dateDayCell = row.querySelector('.date-day-cell');
        const day = dateDayCell ? dateDayCell.querySelector('.day').textContent : '';
        const date = dateDayCell ? dateDayCell.querySelector('.date').textContent : ''; // Keep date for potential future use or debugging

        // Get all meal cells for this row
        const mealCells = row.querySelectorAll('.meal-cell');

        // Process each meal cell (Breakfast, Lunch, Snacks, Dinner, or Brunch)
        mealCells.forEach((cell) => {
          const mealTitleElement = cell.querySelector('.meal-title');
          const mealType = mealTitleElement ? mealTitleElement.textContent : '';

          // Collect all dishes for this meal type across all subcategories
          const allDishes = [];
          cell.querySelectorAll('.meal-section').forEach(section => {
              section.querySelectorAll('.food-item').forEach(itemElement => {
                allDishes.push(itemElement.textContent.trim());
              });
          });

          // If there are dishes for this meal type, add a row to sheetData
          if (allDishes.length > 0) {
            const rowData = [day, mealType];
            // Add up to 4 dishes, fill with empty strings if less
            for (let i = 0; i < 4; i++) {
                rowData.push(allDishes[i] || '');
            }
            sheetData.push(rowData);
          }
        });
      });

      console.log("Prepared sheet data:", sheetData);

      // Create a new workbook
      const wb = XLSX.utils.book_new();

      // Add data to worksheet starting from the second row (after header)
      // Use origin: -1 to append data after the header already added with aoa_to_sheet
      if (sheetData.length > 0) {
           XLSX.utils.sheet_add_aoa(ws, sheetData, {origin: -1});
      } else {
           console.warn("No data to add to the Excel sheet.");
      }

      // Add worksheet to workbook
      XLSX.utils.book_append_sheet(wb, ws, "Menu");

      // Generate and trigger download of Excel file
      const fileName = "menu_" + new Date().toISOString().split('T')[0] + ".xlsx";
      try {
          XLSX.writeFile(wb, fileName);
          console.log(`Successfully generated and attempted to download ${fileName}`);
      } catch (error) {
          console.error("Error writing or downloading Excel file:", error);
          alert("An error occurred while trying to save the Excel file.");
      }
    }

    // BOM Modal Functions
    function showBomPopup() {
      document.getElementById('bomModal').style.display = 'flex';
    }

    function closeBomModal() {
      document.getElementById('bomModal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('bomModal');
      if (event.target === modal) {
        closeBomModal();
      }
    }

    // Handle sidebar menu for mobile
    const sideMenu = document.querySelector("aside");
    const menuBtn = document.querySelector("#menu-btn");
    const closeBtn = document.querySelector(".close-btn");

    menuBtn.addEventListener('click', () => {
      sideMenu.style.display = 'block';
    });

    closeBtn.addEventListener('click', () => {
      sideMenu.style.display = 'none';
    });
  </script>
  <!-- Add SheetJS library -->
  <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
</body>
</html>



